<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Manager (Realtime DB)</title>
  <style>
  /* Global Reset */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body { 
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2); 
    min-height: 100vh; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    padding: 20px;
    color: #333;
  }

  .container { 
    width: 100%; 
    max-width: 700px; 
    background: #fff; 
    padding: 30px; 
    border-radius: 16px; 
    box-shadow: 0 8px 20px rgba(0,0,0,0.25); 
    animation: fadeIn 0.8s ease-in-out; 
  }

  h1, h2, h3 { 
    text-align: center; 
    margin-bottom: 15px; 
    color: #222;
  }

  .form-group { margin-bottom: 18px; }
  label { 
    display: block; 
    margin-bottom: 6px; 
    font-weight: 600; 
    font-size: 14px; 
    color: #444; 
  }
  input, textarea { 
    width: 100%; 
    padding: 12px; 
    border: 1px solid #ddd; 
    border-radius: 8px; 
    font-size: 15px; 
    transition: 0.3s; 
  }
  input:focus, textarea:focus { 
    border-color: #667eea; 
    box-shadow: 0 0 5px rgba(102,126,234,0.6); 
    outline: none; 
  }

  /* Buttons */
  button { 
    margin: 6px 0; 
    padding: 12px 18px; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    font-weight: 600; 
    font-size: 14px;
    transition: 0.3s ease; 
  }
  .btn { background: #667eea; color: #fff; }
  .btn:hover { background: #5a67d8; transform: translateY(-2px); }
  .btn-secondary { background: #6c757d; color: #fff; }
  .btn-secondary:hover { background: #565e64; transform: translateY(-2px); }
  .btn-danger { background: #e53e3e; color: #fff; }
  .btn-danger:hover { background: #c53030; transform: translateY(-2px); }
  .btn-small { padding: 6px 10px; font-size: 12px; }

  /* Messages */
  .error-message { 
    color: #e53e3e; 
    margin: 10px 0; 
    text-align: center; 
    font-weight: bold; 
    background: #ffe5e5; 
    padding: 8px; 
    border-radius: 6px; 
  }
  .success-message { 
    color: #2f855a; 
    margin: 10px 0; 
    text-align: center; 
    font-weight: bold; 
    background: #e6fffa; 
    padding: 8px; 
    border-radius: 6px; 
  }
  .hidden { display: none; }

  /* Task Items */
  .task-item { 
    padding: 15px; 
    border: 1px solid #ddd; 
    border-radius: 10px; 
    margin-bottom: 12px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    background: #f9f9f9; 
    transition: 0.3s; 
  }
  .task-item:hover { 
    background: #f1f1f1; 
    transform: translateX(3px); 
  }
  .task-item.completed { 
    background: #d1fae5; 
    text-decoration: line-through; 
    color: #555; 
  }
  .task-actions button { margin-left: 8px; }

  /* Animations */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

</head>
<body>
  <div class="container">
    <!-- Authentication Section -->
    <div id="auth-section" class="auth-container">
      <h1>Task Manager</h1>
      <div id="error-message" class="error-message hidden"></div>
      <div id="success-message" class="success-message hidden"></div>

      <!-- Login Form -->
      <div id="login-form">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" placeholder="Enter your email">
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" placeholder="Enter your password">
        </div>
        <button class="btn" onclick="login()">Login</button>
        <button class="btn btn-secondary" onclick="showRegister()">Register</button>
      </div>

      <!-- Register Form -->
      <div id="register-form" class="hidden">
        <div class="form-group">
          <label for="register-email">Email</label>
          <input type="email" id="register-email" placeholder="Enter your email">
        </div>
        <div class="form-group">
          <label for="register-password">Password</label>
          <input type="password" id="register-password" placeholder="Create a password (min 6 characters)">
        </div>
        <button class="btn" onclick="register()">Register</button>
        <button class="btn btn-secondary" onclick="showLogin()">Back to Login</button>
      </div>
    </div>

    <!-- Task Manager Section -->
    <div id="task-manager" class="task-manager hidden">
      <div class="user-info" style="display: flex; justify-content: space-between; align-items: center;">
        <h2>My Tasks</h2>
        <div>
          <span id="user-email"></span>
          <button class="btn btn-danger btn-small" onclick="logout()">Logout</button>
        </div>
      </div>

      <!-- Add/Edit Task Form -->
      <div class="task-form">
        <h3 id="form-title">Add New Task</h3>
        <div class="form-group">
          <label for="task-title">Title</label>
          <input type="text" id="task-title" placeholder="Enter task title">
        </div>
        <div class="form-group">
          <label for="task-description">Description</label>
          <textarea id="task-description" placeholder="Enter task description (optional)"></textarea>
        </div>
        <button class="btn" onclick="saveTask()">Save Task</button>
        <button class="btn btn-secondary hidden" id="cancel-edit" onclick="cancelEdit()">Cancel</button>
      </div>

      <!-- Task List -->
      <div id="task-list" class="task-list">
        <div class="loading">Loading tasks...</div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBtwPJIJA1U4BBXkLDUdG_lXpDZlvdV6aM",
      authDomain: "crud-e7057.firebaseapp.com",
      databaseURL: "https://crud-e7057-default-rtdb.firebaseio.com", // âœ… Realtime DB URL
      projectId: "crud-e7057",
      storageBucket: "crud-e7057.appspot.com",
      messagingSenderId: "245810383088",
      appId: "1:245810383088:web:d9d8c4ebda9be668dd1a35"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let currentUser = null;
    let editingTaskId = null;

    // Auth state
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        showTaskManager();
        loadTasks();
      } else {
        currentUser = null;
        showAuth();
      }
    });

    // UI functions
    function showAuth() {
      document.getElementById('auth-section').classList.remove('hidden');
      document.getElementById('task-manager').classList.add('hidden');
    }
    function showTaskManager() {
      document.getElementById('auth-section').classList.add('hidden');
      document.getElementById('task-manager').classList.remove('hidden');
      document.getElementById('user-email').textContent = currentUser.email;
    }
    function showLogin() {
      document.getElementById('login-form').classList.remove('hidden');
      document.getElementById('register-form').classList.add('hidden');
      clearMessages();
    }
    function showRegister() {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('register-form').classList.remove('hidden');
      clearMessages();
    }

    function showError(msg) {
      const e = document.getElementById('error-message');
      e.textContent = msg;
      e.classList.remove('hidden');
      document.getElementById('success-message').classList.add('hidden');
    }
    function showSuccess(msg) {
      const s = document.getElementById('success-message');
      s.textContent = msg;
      s.classList.remove('hidden');
      document.getElementById('error-message').classList.add('hidden');
    }
    function clearMessages() {
      document.getElementById('error-message').classList.add('hidden');
      document.getElementById('success-message').classList.add('hidden');
    }

    // Auth functions
    async function register() {
      const email = document.getElementById('register-email').value.trim();
      const password = document.getElementById('register-password').value;
      if (!email || !password) return showError("Please fill in all fields");
      if (password.length < 6) return showError("Password must be at least 6 characters");
      try {
        await auth.createUserWithEmailAndPassword(email, password);
        showSuccess("Registration successful! Please login.");
        showLogin();
      } catch (err) { showError(err.message); }
    }
    async function login() {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      if (!email || !password) return showError("Please fill in all fields");
      try {
        await auth.signInWithEmailAndPassword(email, password);
        showSuccess("Login successful!");
      } catch (err) {
        showError(err.message);
      }
    }
    async function logout() { await auth.signOut(); clearTaskForm(); }

    // Task functions
    function clearTaskForm() {
      document.getElementById('task-title').value = "";
      document.getElementById('task-description').value = "";
      editingTaskId = null;
      document.getElementById('form-title').textContent = "Add New Task";
      document.getElementById('cancel-edit').classList.add('hidden');
    }

    async function saveTask() {
      const title = document.getElementById('task-title').value.trim();
      const description = document.getElementById('task-description').value.trim();
      if (!title) return showError("Task title is required");

      try {
        if (editingTaskId) {
          await db.ref("tasks/" + currentUser.uid + "/" + editingTaskId).update({ title, description });
          showSuccess("Task updated!");
        } else {
          const newTaskRef = db.ref("tasks/" + currentUser.uid).push();
          await newTaskRef.set({
            title,
            description,
            completed: false,
            createdAt: Date.now()
          });
          showSuccess("Task added!");
        }
        clearTaskForm();
      } catch (err) { showError(err.message); }
    }

    function loadTasks() {
      const list = document.getElementById('task-list');
      db.ref("tasks/" + currentUser.uid).orderByChild("createdAt").on("value", snapshot => {
        list.innerHTML = "";
        if (!snapshot.exists()) {
          list.innerHTML = "<p>No tasks yet.</p>";
          return;
        }
        snapshot.forEach(child => {
          const task = child.val();
          const taskId = child.key;
          const item = document.createElement("div");
          item.className = "task-item " + (task.completed ? "completed" : "");
          item.innerHTML = `
            <div>
              <strong>${task.title}</strong><br>
              <small>${task.description || ""}</small>
            </div>
            <div class="task-actions">
              <button class="btn-small btn" onclick="toggleTask('${taskId}', ${!task.completed})">${task.completed ? "Undo" : "Complete"}</button>
              <button class="btn-small btn-secondary" onclick="editTask('${taskId}', '${task.title}', '${task.description || ""}')">Edit</button>
              <button class="btn-small btn-danger" onclick="deleteTask('${taskId}')">Delete</button>
            </div>
          `;
          list.prepend(item);
        });
      });
    }

    async function toggleTask(id, completed) {
      try {
        await db.ref("tasks/" + currentUser.uid + "/" + id).update({ completed });
      } catch (err) { showError(err.message); }
    }

    function editTask(id, title, description) {
      document.getElementById('task-title').value = title;
      document.getElementById('task-description').value = description;
      editingTaskId = id;
      document.getElementById('form-title').textContent = "Edit Task";
      document.getElementById('cancel-edit').classList.remove('hidden');
    }

    async function deleteTask(id) {
      try {
        await db.ref("tasks/" + currentUser.uid + "/" + id).remove();
        showSuccess("Task deleted!");
      } catch (err) { showError(err.message); }
    }

    function cancelEdit() { clearTaskForm(); }
  </script>
</body>
</html>
